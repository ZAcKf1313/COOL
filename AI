local fighter = script.Parent
local newCharacter = fighter:Clone()
newCharacter.Parent = game.ServerStorage
wait(0.5)
pathFind = game:GetService("PathfindingService")
local humanoid = fighter:WaitForChild("Humanoid")
local torso = fighter:WaitForChild("UpperTorso")
local target = fighter:WaitForChild("Target")
local location = fighter:WaitForChild("Location")

local sp = script.Parent
local humanoid = sp:WaitForChild("Humanoid")
local toolNone = script:FindFirstChild("toolnone")
local toolNoneAnim = toolNone:FindFirstChild("ToolNoneAnim")

local a = Vector3.new(100,5,-100)
local b = Vector3.new(75,5,-200)
local debounce = true
local debounce2 = false
local toolNoning = humanoid:LoadAnimation(toolNoneAnim)
local list = game.Players:GetChildren()
local loco = 100000
local down = script.Parent.Sword:WaitForChild("MouseDown")


sp.PrimaryPart = sp:WaitForChild("Head")


if target.Value then
	local targetUpperTorso = target.Value:FindFirstChild("UpperTorso")
end

function attack(hit)
	if hit and hit.Parent then
		local enemy = hit.Parent:FindFirstChild("Humanoid")
		if enemy then
			if enemy:IsA("Humanoid") and hit.Parent.Name ~= sp.Name and not hit.Parent:FindFirstChild("Frend") then
				debounce = true
				while debounce do
					toolNoning:Play()
					wait(1)
					torso.TouchEnded:connect(function(hit2)
						if hit2 == hit then
							debounce = false
						end
					end)
				end
			end
		else
			if hit.CanCollide then
				humanoid.Jump = true
			end
		end
	end
end

function findPlayers()
	list = game.Workspace:GetChildren() --Players got replaced by Workspace
	local temp = nil--added
	for i=1,#list do
		temp = list[i]
		if temp and temp.className == "Model" and temp~=script.Parent then -- list [i] and list[i]:IsA("Player") then
			local found = temp:FindFirstChild("Humanoid") -- temp should be list[i].Character , 
			if found and found.Health>0 and not found.Parent:FindFirstChild("Frend") then
				local loc = (torso.Position - temp.UpperTorso.Position).magnitude -- temp should be list[i].Character
				if loc < loco then
					loco = loc
					target.Value = temp -- temp should be list[i].Character
				end
			end
		end
	end
end


while humanoid.Health > 0 do
	target = sp:WaitForChild("Target")
	location = sp:WaitForChild("Location")
	findPlayers()
	if target.Value then
		targetUpperTorso = target.Value:FindFirstChild("UpperTorso")
		if targetUpperTorso then
			path = pathFind:ComputeRawPathAsync(torso.Position,targetUpperTorso.Position,500)
			points = path:GetPointCoordinates()
			if #points <10 or #points == 10 then
				mx = #points
				l = true
			else
				mx = 10
				l = false
			end
			for i = 1,mx/2 do
				wait(0.25)
				humanoid:MoveTo(points[i*2])
				if i == mx/2 and l then
					humanoid:MoveTo(targetUpperTorso.Position,targetUpperTorso)
				end
			end
		end
	else
		path = pathFind:ComputeRawPathAsync(torso.Position,location.Value,500)
		points = path:GetPointCoordinates()
		if #points <10 then
			mx = #points
		else
			mx = 10
		end
		for i = 1,mx do
			humanoid:MoveTo(points[i])
			wait(0.25)
		end
		humanoid:MoveTo(location.Value)
	end
	loco = 100000
	torso.Touched:connect(attack)
	down:Fire()
	wait(0.7)
	down:Fire()
	wait(0.1)
	down:Fire()
	wait(0.5)
end

if humanoid.Health == 0 or humanoid.Health < 0 then
	wait(5)
	newCharacter.Parent = workspace
	wait(0.1)
	sp:Destroy()
end
